<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>dmorphink.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>dmorphink.h</h1>  </div>
</div>
<div class="contents">
<a href="dmorphink_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef DMORPHINK_H</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define DMORPHINK_H</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &quot;<a class="code" href="dimage_8h.html">dimage.h</a>&quot;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &quot;<a class="code" href="dmath_8h.html">dmath.h</a>&quot;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00007"></a>00007 
<a name="l00008"></a><a class="code" href="dmorphink_8h.html#ac9cc1c2f659f9fbeb096ad27272298b9">00008</a> <span class="preprocessor">#define SPEED_TEST 1</span>
<a name="l00009"></a><a class="code" href="dmorphink_8h.html#ac715723a07403fe8c5a84ecfa3881d76">00009</a> <span class="preprocessor"></span><span class="preprocessor">#define SPEED_TEST2 1</span>
<a name="l00010"></a><a class="code" href="dmorphink_8h.html#aff5737d1b4b4f97a7cad06800cff6532">00010</a> <span class="preprocessor"></span><span class="preprocessor">#define SPEED_TEST3 1</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 
<a name="l00014"></a><a class="code" href="dmorphink_8h.html#a4686026ff781e42a6cdbf91333a7d2a3">00014</a> <span class="preprocessor">#define DEBUG_WARP_POINT 0</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span>
<a name="l00016"></a><a class="code" href="dmorphink_8h.html#a55be57b5e024a43d7fc0796bf2b11987">00016</a> <span class="preprocessor">#define NEW_WARP 1 </span><span class="comment">/*attempt at faster warpPoint function &amp; re-tooling for it*/</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="comment">//#define COMPENSATE_FOR_OOB_DISTMAP 1 //we now do this all the time</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">//#define CHECK_OLD_WARP 1 /*I fixed the difference between warpPoint and warpPointAtTime after the dissertation.  They both use &gt;0. now instead of warpPoint using &gt;=1.0 like it used to.*/</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00050"></a><a class="code" href="classDMorphInk.html">00050</a> <span class="keyword">class </span><a class="code" href="classDMorphInk.html">DMorphInk</a>{
<a name="l00051"></a>00051 <span class="keyword">public</span>:
<a name="l00052"></a>00052   <a class="code" href="classDMorphInk.html#aed7163490e24ad916e341055a15eabba">DMorphInk</a>();
<a name="l00053"></a>00053   <a class="code" href="classDMorphInk.html#a0cbc191ad098412f1c19ab54f09d167b">~DMorphInk</a>();
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a6fd057f3a92f0e368066a394bea66fbd" title="Returns the &amp;quot;difference&amp;quot; metric between two words.">getWordMorphCost</a>(<span class="keyword">const</span> <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> &amp;src0, <span class="keyword">const</span> <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> &amp;src1,
<a name="l00056"></a>00056         <span class="keywordtype">int</span> bandWidthDP = 15,
<a name="l00057"></a>00057         <span class="keywordtype">double</span> nonDiagonalCostDP=0.,
<a name="l00058"></a>00058         <span class="keywordtype">int</span> meshSpacingStatic=-1,
<a name="l00059"></a>00059         <span class="keywordtype">int</span> numRefinementsStatic=-1,
<a name="l00060"></a>00060         <span class="keywordtype">double</span> meshDiv=4.0,
<a name="l00061"></a>00061         <span class="keywordtype">double</span> lengthMismatchPenalty=0.0);
<a name="l00062"></a>00062   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a43a73b652f9d43f6c2c0ff7a2871e006" title="same as getWordMorphCost except that it forces numImprovesPerRefinement to 1 and numRefinements to 0 ...">getWordMorphCostFast</a>(<span class="keyword">const</span> <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> &amp;src0, <span class="keyword">const</span> <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> &amp;src1,
<a name="l00063"></a>00063              <span class="keywordtype">int</span> bandWidthDP = 15,
<a name="l00064"></a>00064              <span class="keywordtype">double</span> nonDiagonalCostDP=0.,
<a name="l00065"></a>00065              <span class="keywordtype">int</span> meshSpacingStatic=-1,
<a name="l00066"></a>00066              <span class="keywordtype">int</span> numRefinementsStatic=-1,
<a name="l00067"></a>00067              <span class="keywordtype">double</span> meshDiv=4.0,
<a name="l00068"></a>00068              <span class="keywordtype">double</span> lengthMismatchPenalty=0.0);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070   <span class="keywordtype">void</span> <a class="code" href="classDMorphInk.html#a9543066669e57fe172a88838d4ea1add">init</a>(<span class="keyword">const</span> <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> &amp;src0, <span class="keyword">const</span> <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> &amp;src1, <span class="keywordtype">bool</span> fMakeCopies = <span class="keyword">true</span>,
<a name="l00071"></a>00071       <span class="keywordtype">int</span> initialMeshSpacing=50, <span class="keywordtype">int</span> bandRadius=15,
<a name="l00072"></a>00072       <span class="keywordtype">double</span> nonDiagonalDPcost = 0.);
<a name="l00073"></a>00073   <span class="keywordtype">void</span> <a class="code" href="classDMorphInk.html#a959b111d4929e7242b5edb781050d3e4" title="reset meshes. uses col/row spacing on mesh0, uses DP to align mesh1">resetMeshes</a>(<span class="keywordtype">int</span> columnSpacing, <span class="keywordtype">int</span> rowSpacing,<span class="keywordtype">int</span> bandRadius=15,
<a name="l00074"></a>00074        <span class="keywordtype">double</span> nonDiagonalDPcost = 0.);
<a name="l00075"></a>00075   <span class="keywordtype">void</span> <a class="code" href="classDMorphInk.html#ac76cf01b966609d025b74b30b35682ec">refineMeshes</a>();
<a name="l00076"></a>00076   <span class="keywordtype">void</span> <a class="code" href="classDMorphInk.html#ae344e50fc2877b60d688c1fbe39ce3be">improveMorph</a>();
<a name="l00077"></a>00077   <span class="keywordtype">void</span> <a class="code" href="classDMorphInk.html#a1b8ebde11b77732f90e7695af0fc9d3e">improveMorphFast</a>();
<a name="l00078"></a>00078   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a72b281fcba3e7d904c723185a93e3862">getVertexPositionCost</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c, <span class="keywordtype">double</span> x1, <span class="keywordtype">double</span> y1);
<a name="l00079"></a>00079   <span class="keywordtype">bool</span> <a class="code" href="classDMorphInk.html#ae1ffaf3113f7760ed8ccee097d842404">warpPoint</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> *xp, <span class="keywordtype">double</span> *yp, <span class="keywordtype">bool</span> fDebugPrint=<span class="keyword">false</span>);
<a name="l00080"></a>00080 <span class="preprocessor">#if NEW_WARP</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span>  <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#ab8fda39ed4fcca5acfc5d2cddf06fbf6">getVertexPositionCostNew</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c, <span class="keywordtype">double</span> x1, <span class="keywordtype">double</span> y1);
<a name="l00082"></a>00082   <span class="keywordtype">void</span> <a class="code" href="classDMorphInk.html#ac12c0b70e56ec25a1d70faf24848441d">warpPointNew</a>(<span class="keywordtype">double</span> s, <span class="keywordtype">double</span> t, <span class="keywordtype">int</span> meshPointIdx,<span class="keywordtype">double</span> *xp, <span class="keywordtype">double</span> *yp
<a name="l00083"></a>00083         <span class="comment">/*debug: ,double x,double y, int ii=-1, int l=-1,</span>
<a name="l00084"></a>00084 <span class="comment">        int rgTempMA0idx_i=-1, int r=-1, int c=-1*/</span>);
<a name="l00085"></a>00085 <span class="preprocessor">#endif//NEW_WARP</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span>  <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#abddc59e5e76b17007a8c747435df63c1">getCost</a>();
<a name="l00087"></a>00087 
<a name="l00088"></a>00088   <span class="comment">// bool isCoordInQuad(double x, double y, int quadIdx,</span>
<a name="l00089"></a>00089   <span class="comment">//         double *rgMeshXs, double *rgMeshYs);</span>
<a name="l00090"></a>00090   <span class="comment">// int getQuadIdxFromCoord(double x, double y, double *rgXs, double *rgYs,</span>
<a name="l00091"></a>00091   <span class="comment">//        int lastQuadIdx = -1);</span>
<a name="l00092"></a>00092   <span class="comment">// double bilinearInterpDistMap(double xp, double yp, signed int *psDist,</span>
<a name="l00093"></a>00093   <span class="comment">//             int w, int h);</span>
<a name="l00094"></a>00094   <span class="comment">//-------------------------------------------------------------------------</span>
<a name="l00095"></a>00095   <span class="comment">// functions for visualization / debug</span>
<a name="l00096"></a>00096   <span class="comment">//-------------------------------------------------------------------------</span>
<a name="l00097"></a>00097   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#a56f3d44a477ba7a0f3532b306a422b74">getImageWithMesh</a>(<span class="keywordtype">int</span> meshNum);
<a name="l00098"></a>00098   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#abd25c964b128f3eb8b6c1a9d3e255059">getMedialAxisWithMesh</a>(<span class="keywordtype">int</span> meshNum);
<a name="l00099"></a>00099   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#a2dd734e858e594b00e5dc9e34ed30b7e">getBothMedialAxes</a>(<span class="keywordtype">bool</span> fWarpPoints0, <span class="keywordtype">bool</span> fShowGreenDistance = <span class="keyword">false</span>);
<a name="l00100"></a>00100   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#a173f5013e097eb272d40917e27cf8e48">getBothMedialAxesWithMesh</a>(<span class="keywordtype">bool</span> fWarpPoints0, <span class="keywordtype">int</span> mesh0or1);
<a name="l00101"></a>00101   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#a219a84a95871ee7052ccd002b67452dd">getWarpedMedialAxis0_A0prime</a>();
<a name="l00102"></a>00102   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#a8c3405884b1b1142b6a6e524369d9a40" title="Used for DEBUG/visualization only.">getMorphAtTime</a>(<span class="keywordtype">double</span> dblTime, <span class="keywordtype">bool</span> fWarpOnly = <span class="keyword">false</span>,
<a name="l00103"></a>00103       <span class="keywordtype">bool</span> fDrawMesh = <span class="keyword">false</span>, <span class="keywordtype">double</span> pad_val = 128.,
<a name="l00104"></a>00104       <span class="keywordtype">bool</span> fOverlayImg1=<span class="keyword">false</span>, <span class="keywordtype">bool</span> fShowMedialAxis0 = <span class="keyword">false</span>,
<a name="l00105"></a>00105       <span class="keywordtype">bool</span> fShowMedialAxis1 = <span class="keyword">false</span>, <span class="keywordtype">bool</span> fNoMorph=<span class="keyword">false</span>);
<a name="l00106"></a>00106   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#ac03b4972f63a38cc6876b2f67601223d" title="Returns the morph at some point between 0. and 1. (inclusive)">getMorphOverlayAtTime</a>(<span class="keywordtype">double</span> dblTime, 
<a name="l00107"></a>00107              <span class="keywordtype">bool</span> fDrawMesh = <span class="keyword">false</span>, <span class="keywordtype">double</span> pad_val = 128.,
<a name="l00108"></a>00108              <span class="keywordtype">bool</span> fShowMedialAxis0 = <span class="keyword">false</span>,
<a name="l00109"></a>00109              <span class="keywordtype">bool</span> fShowMedialAxis1 = <span class="keyword">false</span>, <span class="keywordtype">int</span> scale=1,
<a name="l00110"></a>00110              <span class="keywordtype">bool</span> fStartAtDP = <span class="keyword">false</span>,
<a name="l00111"></a>00111              <span class="keywordtype">bool</span> fStartAtPreviousEnd = <span class="keyword">false</span>);
<a name="l00112"></a>00112   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#a264a9d900ddd932aa9d2e76b10f30e10" title="linearly interpolated the positions of MA0 starting at DP-warped positions">getMovementHeatmapAtTime</a>(<span class="keywordtype">double</span> dblTime, 
<a name="l00113"></a>00113           <span class="keywordtype">bool</span> fDrawMesh = <span class="keyword">false</span>,
<a name="l00114"></a>00114           <span class="keywordtype">bool</span> fShowMedialAxisDP = <span class="keyword">false</span>,
<a name="l00115"></a>00115           <span class="keywordtype">bool</span> fShowMedialAxisTarget = <span class="keyword">false</span>,
<a name="l00116"></a>00116           <span class="keywordtype">int</span> scale=1,
<a name="l00117"></a>00117           <span class="keywordtype">bool</span> fStartAtDP = <span class="keyword">false</span>,
<a name="l00118"></a>00118           <span class="keywordtype">bool</span> fStartAtPreviousEnd = <span class="keyword">false</span>);
<a name="l00119"></a>00119   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#ac9f15e07a42251dbe59e75fa9db8783c">getLinearHeatmapAtTimeFromDP</a>(<span class="keywordtype">double</span> dblTime,
<a name="l00120"></a>00120               <span class="keywordtype">bool</span> fShowMedialAxisDP = <span class="keyword">false</span>,
<a name="l00121"></a>00121               <span class="keywordtype">bool</span> fShowMA0prime = <span class="keyword">false</span>,
<a name="l00122"></a>00122               <span class="keywordtype">bool</span> fShowMedialAxisTarget = <span class="keyword">false</span>,
<a name="l00123"></a>00123               <span class="keywordtype">int</span> scale = 1, <span class="keywordtype">double</span> *avgDistMoved=NULL);
<a name="l00124"></a>00124   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#a17f202b00f809879b31fc461516a4b44">getWarpedMedialAxesWithSmoothMesh</a>(<span class="keywordtype">bool</span> fShowMA0=<span class="keyword">true</span>,
<a name="l00125"></a>00125              <span class="keywordtype">bool</span> fShowMA1=<span class="keyword">true</span>);
<a name="l00126"></a>00126   <span class="keywordtype">void</span> <a class="code" href="classDMorphInk.html#a30bb260f50397fc2612be1d56b661948">setPreviousPoints</a>();
<a name="l00127"></a>00127   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#adb6f734572f49d50adb6d1004385c247">getMorphAtTimeForOtherImages</a>(<a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> &amp;img0, <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> &amp;img1);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129   <span class="keywordtype">bool</span> <a class="code" href="classDMorphInk.html#afca1cf9b91b32ccb22d2d9e4cd5221fc" title="This function is used for visualization / debug only.">warpPointAtTime</a>(<span class="keywordtype">double</span> x,<span class="keywordtype">double</span> y, <span class="keywordtype">double</span> *xp, <span class="keywordtype">double</span> *yp, <span class="keywordtype">double</span> t=1.0);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131   <span class="comment">//  double getCost_fast();//for videos</span>
<a name="l00132"></a>00132 
<a name="l00133"></a>00133   <span class="comment">// void flowInkMA0to1(</span>
<a name="l00134"></a>00134 
<a name="l00135"></a><a class="code" href="classDMorphInk.html#a4357a263bec20756294e06c7b81e568b">00135</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a4357a263bec20756294e06c7b81e568b">warpCostDPfull</a>;<span class="comment">//cost of horizontal+vertical both directions</span>
<a name="l00136"></a>00136   <span class="comment">//the next two will only have the most recent costs (second direction unless</span>
<a name="l00137"></a>00137   <span class="comment">//fOnlyDoOneDirection is true in which case only the first direction).</span>
<a name="l00138"></a><a class="code" href="classDMorphInk.html#af0794d50b4d8f6254397c2a9e2ce6877">00138</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#af0794d50b4d8f6254397c2a9e2ce6877">warpCostDP</a>;<span class="comment">//cost of horizontal DP warping calculated by resetMeshes()</span>
<a name="l00139"></a><a class="code" href="classDMorphInk.html#a67fe43f737518539ce28fa28d925e437">00139</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a67fe43f737518539ce28fa28d925e437">warpCostDPv</a>;<span class="comment">//cost of vertical DP warping calculated by resetMeshes()</span>
<a name="l00140"></a><a class="code" href="classDMorphInk.html#ae039f7b3fa02f687423a554f6738846c">00140</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#ae039f7b3fa02f687423a554f6738846c">warpCostDPhoriz</a>;<span class="comment">//cost of horizontal DP warping (forward+backward)</span>
<a name="l00141"></a>00141 
<a name="l00142"></a><a class="code" href="classDMorphInk.html#a38c9c87d06ba177c7b6b7695546a309e">00142</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a38c9c87d06ba177c7b6b7695546a309e">avgMovement0to1</a>;
<a name="l00143"></a><a class="code" href="classDMorphInk.html#a15d1402e80ae6205e9beebc8291d689c">00143</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a15d1402e80ae6205e9beebc8291d689c">avgMovement1to0</a>;
<a name="l00144"></a><a class="code" href="classDMorphInk.html#a2840ba03aa7935a06641ff1611330087">00144</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a2840ba03aa7935a06641ff1611330087">distmapCost0to1</a>;
<a name="l00145"></a><a class="code" href="classDMorphInk.html#a46abae215af33cf2056294df271ce8c8">00145</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a46abae215af33cf2056294df271ce8c8">distmapCost1to0</a>;
<a name="l00146"></a><a class="code" href="classDMorphInk.html#a343ef3ab133f87f9af55a18d6af4c81d">00146</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a343ef3ab133f87f9af55a18d6af4c81d">cost0to1</a>;
<a name="l00147"></a><a class="code" href="classDMorphInk.html#aa375ceb099c2d5edc29235539e157202">00147</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#aa375ceb099c2d5edc29235539e157202">cost1to0</a>;
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="classDMorphInk.html#ab809888936420d4a609252bb070d282b">00149</a>   <span class="keywordtype">bool</span> <a class="code" href="classDMorphInk.html#ab809888936420d4a609252bb070d282b">fOnlyDoOneDirection</a>;
<a name="l00150"></a><a class="code" href="classDMorphInk.html#ac5767b94ce078228a1ce1c5124e48b69">00150</a>   <span class="keywordtype">bool</span> <a class="code" href="classDMorphInk.html#ac5767b94ce078228a1ce1c5124e48b69">fOnlyDoCoarseAlignment</a>;
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   <span class="comment">//private:</span>
<a name="l00153"></a><a class="code" href="classDMorphInk.html#a1460be45e5c34f65bfa5e955a49de2cc">00153</a>   <span class="keywordtype">int</span> <a class="code" href="classDMorphInk.html#a1460be45e5c34f65bfa5e955a49de2cc">numPointRows</a>;<span class="comment">//numPointRows and numPointCols may differ, but must be kept</span>
<a name="l00154"></a><a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">00154</a>   <span class="keywordtype">int</span> <a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>;<span class="comment">//consistent between the two meshes</span>
<a name="l00155"></a>00155   
<a name="l00156"></a><a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">00156</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>;<span class="comment">//x-coords of mesh0 quad vertices (row-major order)</span>
<a name="l00157"></a><a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">00157</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>;<span class="comment">//y-coords</span>
<a name="l00158"></a><a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">00158</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>;<span class="comment">//same, but for mesh1</span>
<a name="l00159"></a><a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">00159</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>;<span class="comment">//y-coords for mesh1</span>
<a name="l00160"></a><a class="code" href="classDMorphInk.html#a8f57118f881f1823d26866dd21abc28d">00160</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a8f57118f881f1823d26866dd21abc28d">rgPointsDPX</a>;<span class="comment">//rgPoints1X copied right after coarse alignment with DP</span>
<a name="l00161"></a><a class="code" href="classDMorphInk.html#a72ea042008e056af1c0ce37edc23d389">00161</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a72ea042008e056af1c0ce37edc23d389">rgPointsDPY</a>;<span class="comment">//rgPoints1Y copied right after coarse alignment with DP</span>
<a name="l00162"></a><a class="code" href="classDMorphInk.html#a16a04c56e3e73f0207f19558850d9098">00162</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a16a04c56e3e73f0207f19558850d9098">rgPointsPrevX</a>;
<a name="l00163"></a><a class="code" href="classDMorphInk.html#ad545c8c1a6e975a7b4aa10bb77cef1a7">00163</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#ad545c8c1a6e975a7b4aa10bb77cef1a7">rgPointsPrevY</a>;
<a name="l00164"></a><a class="code" href="classDMorphInk.html#a9c5c697d91d45805d8d6d5f242a0248a">00164</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a9c5c697d91d45805d8d6d5f242a0248a">ma0prevPosX</a>;<span class="comment">//prev positions of each medial axis pixel from ma0</span>
<a name="l00165"></a><a class="code" href="classDMorphInk.html#a118b48c907c68ed4241baff7e5885f54">00165</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a118b48c907c68ed4241baff7e5885f54">ma0prevPosY</a>;<span class="comment">//set to -999. if warpPointAtTime returns false</span>
<a name="l00166"></a><a class="code" href="classDMorphInk.html#a513157eb1b01b964c7c13720c707778b">00166</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a513157eb1b01b964c7c13720c707778b">rgMA0X</a>;<span class="comment">//x-coords for medial axis 0</span>
<a name="l00167"></a><a class="code" href="classDMorphInk.html#a38a244b23b4d5b95c3e539a9ff0de67e">00167</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a38a244b23b4d5b95c3e539a9ff0de67e">rgMA0Y</a>;<span class="comment">//y-coords for medial axis 0</span>
<a name="l00168"></a><a class="code" href="classDMorphInk.html#ae8d7c5cf62c8eac1f680a3c3a2dad7e7">00168</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#ae8d7c5cf62c8eac1f680a3c3a2dad7e7">rgMA1X</a>;<span class="comment">//x-coords for medial axis 1</span>
<a name="l00169"></a><a class="code" href="classDMorphInk.html#add295bc3e0ac26a4eda04b34ca89ec17">00169</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#add295bc3e0ac26a4eda04b34ca89ec17">rgMA1Y</a>;<span class="comment">//y-coords for medial axis 1</span>
<a name="l00170"></a>00170 <span class="preprocessor">#if NEW_WARP</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span>  <span class="comment">//these arrays hold values that used to be calculated for every warpPoint call</span>
<a name="l00172"></a><a class="code" href="classDMorphInk.html#a552ebccb2864be1b79e852ff62f97cca">00172</a>   <span class="keywordtype">int</span> *<a class="code" href="classDMorphInk.html#a552ebccb2864be1b79e852ff62f97cca">rgMA0r</a>;
<a name="l00173"></a><a class="code" href="classDMorphInk.html#aeeb1d6ed29d5744836b82def50ba0bf2">00173</a>   <span class="keywordtype">int</span> *<a class="code" href="classDMorphInk.html#aeeb1d6ed29d5744836b82def50ba0bf2">rgMA0c</a>;
<a name="l00174"></a><a class="code" href="classDMorphInk.html#a46ca12996c149156a9a3f2d8578a06cf">00174</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a46ca12996c149156a9a3f2d8578a06cf">rgMA0s</a>;
<a name="l00175"></a><a class="code" href="classDMorphInk.html#a981f15cf32ed62c4531c24c664b8408e">00175</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a981f15cf32ed62c4531c24c664b8408e">rgMA0t</a>;
<a name="l00176"></a><a class="code" href="classDMorphInk.html#ad854c458368b2d560a43b942ff044d03">00176</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#ad854c458368b2d560a43b942ff044d03">rgMA0quadW</a>;
<a name="l00177"></a><a class="code" href="classDMorphInk.html#ad2e49ec90c6cc968632dbf48bc7f4e53">00177</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#ad2e49ec90c6cc968632dbf48bc7f4e53">rgMA0quadH</a>;
<a name="l00178"></a>00178   <span class="comment">//this array holds the indexes for rgMA0 points that are in 4 adjacent quads</span>
<a name="l00179"></a>00179   <span class="comment">//instead of copying everything into rgTempMA0X/Y, etc, we now just</span>
<a name="l00180"></a>00180   <span class="comment">//copy the indexes and look them up in the original full arrays rgMA0X, etc.</span>
<a name="l00181"></a><a class="code" href="classDMorphInk.html#ad9a46e1b8f0d6e02ee16689d884abb15">00181</a>   <span class="keywordtype">int</span> *<a class="code" href="classDMorphInk.html#ad9a46e1b8f0d6e02ee16689d884abb15">rgTempMA0idx</a>;
<a name="l00182"></a>00182 <span class="preprocessor">#endif</span>
<a name="l00183"></a>00183 <span class="preprocessor"></span>
<a name="l00184"></a><a class="code" href="classDMorphInk.html#acdd9fdd6e59516967ae3fbe0a22e0a28">00184</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#acdd9fdd6e59516967ae3fbe0a22e0a28">rgDPMA0X</a>;<span class="comment">//DP-warped coords of MedialAxis0</span>
<a name="l00185"></a><a class="code" href="classDMorphInk.html#aa79725dd5c497bcc5870a06c0c827b97">00185</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#aa79725dd5c497bcc5870a06c0c827b97">rgDPMA0Y</a>;<span class="comment">//DP-warped coords of MedialAxis0</span>
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="classDMorphInk.html#ad6415cde09c56ec851c9abebf538f507">00187</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#ad6415cde09c56ec851c9abebf538f507">rgTempMA0X</a>;<span class="comment">//used by improveMorph,getVertexPositionCost2 </span>
<a name="l00188"></a><a class="code" href="classDMorphInk.html#a6224c8be0e9c5da72766e61ddb1e9912">00188</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a6224c8be0e9c5da72766e61ddb1e9912">rgTempMA0Y</a>;<span class="comment">//used by improveMorph,getVertexPositionCost2 </span>
<a name="l00189"></a><a class="code" href="classDMorphInk.html#afc821bd03aebde29d85de74f6910d3bc">00189</a>   <span class="keywordtype">int</span> <a class="code" href="classDMorphInk.html#afc821bd03aebde29d85de74f6910d3bc">tempMA0len</a>;<span class="comment">//used by improveMorph,getVertexPositionCost2 </span>
<a name="l00190"></a><a class="code" href="classDMorphInk.html#afbaeda7f6fd96ec58b41e2a074d61d6b">00190</a>   <span class="keywordtype">int</span> <a class="code" href="classDMorphInk.html#afbaeda7f6fd96ec58b41e2a074d61d6b">lenMA0</a>;<span class="comment">//number of MA0 (medial axis 0) points</span>
<a name="l00191"></a><a class="code" href="classDMorphInk.html#a6dd89f25352959de7ba8086ee404d311">00191</a>   <span class="keywordtype">int</span> <a class="code" href="classDMorphInk.html#a6dd89f25352959de7ba8086ee404d311">lenMA1</a>;<span class="comment">//number of MA1 (medial axis 1) points</span>
<a name="l00192"></a><a class="code" href="classDMorphInk.html#ae333343ba5732a7f59eada65d7be8634">00192</a>   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> *<a class="code" href="classDMorphInk.html#a7a8914703b860ea0d1a73863f77bbaf0">pimg0</a>,*<a class="code" href="classDMorphInk.html#ae333343ba5732a7f59eada65d7be8634">pimg1</a>;<span class="comment">//pointers to the source images (or copies if applicable)</span>
<a name="l00193"></a><a class="code" href="classDMorphInk.html#afa02a5029dcbffd64b6ac27a6b8eb744">00193</a>   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#a5a95cbfee21a72aa887f4476ff344222">img0tmp</a>, <a class="code" href="classDMorphInk.html#afa02a5029dcbffd64b6ac27a6b8eb744">img1tmp</a>;<span class="comment">//if images are copied by init(), point to these</span>
<a name="l00194"></a><a class="code" href="classDMorphInk.html#abe11be729724802b7e22392b5ab9608f">00194</a>   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#ab65ca4c00351f6514d4fe87dcd75fe43">imgDist0</a>, <a class="code" href="classDMorphInk.html#abe11be729724802b7e22392b5ab9608f">imgDist1</a>;<span class="comment">//distance maps (DImage_u32) for each image</span>
<a name="l00195"></a><a class="code" href="classDMorphInk.html#a55981f9154822f562280bf9c9193dcbc">00195</a>   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#a0cff1bf3bbe9b931aab6137b00c4dcd1">imgMA0</a>, <a class="code" href="classDMorphInk.html#a55981f9154822f562280bf9c9193dcbc">imgMA1</a>;<span class="comment">//medialAxis images</span>
<a name="l00196"></a><a class="code" href="classDMorphInk.html#ad5feaff28443e1d35021581ec67ea6a5">00196</a>   <a class="code" href="classDImage.html" title="This class is the internal storage structure for images of various data formats.">DImage</a> <a class="code" href="classDMorphInk.html#ad5feaff28443e1d35021581ec67ea6a5">imgInk0</a>;<span class="comment">//medial axis (or all ink) in image0</span>
<a name="l00197"></a><a class="code" href="classDMorphInk.html#ab66030e7c8782eb1174513f4b9e31b84">00197</a>   <span class="keywordtype">int</span> <a class="code" href="classDMorphInk.html#a9d10a90d3b5a684823850fe7186cf1fc">w0</a>, <a class="code" href="classDMorphInk.html#ab34c8fc99bea6c6c7b2f66077a375ae7">h0</a>, <a class="code" href="classDMorphInk.html#ab66030e7c8782eb1174513f4b9e31b84">w1</a>, <a class="code" href="classDMorphInk.html#ae34737032c7664485685e84712d56217">h1</a>; <span class="comment">//width,height of the two images (don&#39;t have to be equal)</span>
<a name="l00198"></a><a class="code" href="classDMorphInk.html#a5b85e6465727074de4079692818df9d0">00198</a>   <span class="keywordtype">int</span> <a class="code" href="classDMorphInk.html#ab26e229fbec08947e2396369e6529d2c">initialColSpacing</a>, <a class="code" href="classDMorphInk.html#a5b85e6465727074de4079692818df9d0">initialRowSpacing</a>;
<a name="l00199"></a><a class="code" href="classDMorphInk.html#a5a0fe7a38c9ec383a171e325d172bf3d">00199</a>   <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a1c93aa4e31c88760d35621e48b4b621a">curColSpacing</a>, <a class="code" href="classDMorphInk.html#a5a0fe7a38c9ec383a171e325d172bf3d">curRowSpacing</a>;
<a name="l00200"></a><a class="code" href="classDMorphInk.html#ab54612999973cee33034e5152fb7d477">00200</a>   <span class="keywordtype">int</span> <a class="code" href="classDMorphInk.html#ab54612999973cee33034e5152fb7d477">meshLevel</a>;
<a name="l00201"></a><a class="code" href="classDMorphInk.html#a832c7460f52b4cc64123901c068f5566">00201</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a832c7460f52b4cc64123901c068f5566">rgBackmapX1toX0</a>;
<a name="l00202"></a><a class="code" href="classDMorphInk.html#a5f5ec417551250009f8b2673fa29c843">00202</a>   <span class="keywordtype">double</span> *<a class="code" href="classDMorphInk.html#a5f5ec417551250009f8b2673fa29c843">rgBackmapY1toY0</a>;
<a name="l00203"></a><a class="code" href="classDMorphInk.html#a4876c59386fc9406b807e2f3ecdb4517">00203</a>   <span class="keywordtype">bool</span> <a class="code" href="classDMorphInk.html#a4876c59386fc9406b807e2f3ecdb4517">fFaintMesh</a>;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00206"></a><a class="code" href="classDMorphInk.html#a4cf1abc4030a76447442558c5316248b">00206</a>   <span class="keywordtype">bool</span> *<a class="code" href="classDMorphInk.html#a4cf1abc4030a76447442558c5316248b">rgPlacePoints0</a>;<span class="comment">//if false, no points in 4 adjacent quads, so don&#39;t place</span>
<a name="l00207"></a>00207 };
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 
<a name="l00212"></a>00212 
<a name="l00213"></a><a class="code" href="classDMorphInk.html#afca1cf9b91b32ccb22d2d9e4cd5221fc">00213</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classDMorphInk.html#afca1cf9b91b32ccb22d2d9e4cd5221fc" title="This function is used for visualization / debug only.">DMorphInk::warpPointAtTime</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> *xp,
<a name="l00214"></a>00214                <span class="keywordtype">double</span> *yp, <span class="keywordtype">double</span> dblTime){
<a name="l00215"></a>00215   <span class="keywordtype">int</span> r, c, idx;
<a name="l00216"></a>00216   <span class="keywordtype">double</span> Xtop, Ytop, Xbot, Ybot;
<a name="l00217"></a>00217   <span class="keywordtype">double</span> s,t;
<a name="l00218"></a>00218   <span class="keywordtype">double</span> Ax, Ay, Bx, By, Cx, Cy, Dx, Dy;<span class="comment">//quad vertices at dblTime (NW,NE,SE,SW)</span>
<a name="l00219"></a>00219 
<a name="l00220"></a>00220   <span class="keywordflow">if</span>((x&lt;0)||(y&lt;0)||(x&gt;(<a class="code" href="classDMorphInk.html#a9d10a90d3b5a684823850fe7186cf1fc">w0</a>-1))||(y&gt;(<a class="code" href="classDMorphInk.html#ab34c8fc99bea6c6c7b2f66077a375ae7">h0</a>-1))){
<a name="l00221"></a>00221     <span class="comment">// fprintf(stderr,</span>
<a name="l00222"></a>00222     <span class="comment">//      &quot;DMorphInk::warpPoint() point %lf,%lf out of img0 bounds &quot;</span>
<a name="l00223"></a>00223     <span class="comment">//      &quot;(0,0-%d,%d)\n&quot;,x,y,w0-1,h0-1);</span>
<a name="l00224"></a>00224     (*xp)=0.;
<a name="l00225"></a>00225     (*yp)=0.;
<a name="l00226"></a>00226     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00227"></a>00227   }
<a name="l00228"></a>00228   <span class="keywordflow">if</span>((dblTime &lt; 0.)||(dblTime &gt; 1.0)){
<a name="l00229"></a>00229     fprintf(stderr,<span class="stringliteral">&quot;DMorphInk::warpPointAtTime() dblTime must be 0. to 1.\n&quot;</span>);
<a name="l00230"></a>00230     exit(1);
<a name="l00231"></a>00231   }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233   <span class="comment">//r,c are easy to find because mesh0 is evenly spaced</span>
<a name="l00234"></a>00234   s = x / <a class="code" href="classDMorphInk.html#a1c93aa4e31c88760d35621e48b4b621a">curColSpacing</a>;
<a name="l00235"></a>00235   t = y / <a class="code" href="classDMorphInk.html#a5a0fe7a38c9ec383a171e325d172bf3d">curRowSpacing</a>;
<a name="l00236"></a>00236   c = (int)s;
<a name="l00237"></a>00237   <span class="keywordflow">if</span>(c == (<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>-1))<span class="comment">//if last pixel, make it s=1.0 for c=numPointsCols-2</span>
<a name="l00238"></a>00238     --c;
<a name="l00239"></a>00239   r = (int)t;
<a name="l00240"></a>00240   <span class="keywordflow">if</span>(r == (<a class="code" href="classDMorphInk.html#a1460be45e5c34f65bfa5e955a49de2cc">numPointRows</a>-1))<span class="comment">//if last pixel, make it t=1.0 for r=numPointsRows-2</span>
<a name="l00241"></a>00241     --r;
<a name="l00242"></a>00242   idx = r*<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+c;
<a name="l00243"></a>00243   s -= c;
<a name="l00244"></a>00244   t -= r;
<a name="l00245"></a>00245   
<a name="l00246"></a>00246   <span class="keywordtype">double</span> quadW;
<a name="l00247"></a>00247   <span class="keywordtype">double</span> quadH;
<a name="l00248"></a>00248   quadW = <a class="code" href="classDMorphInk.html#a1c93aa4e31c88760d35621e48b4b621a">curColSpacing</a>;
<a name="l00249"></a>00249   quadH = <a class="code" href="classDMorphInk.html#a5a0fe7a38c9ec383a171e325d172bf3d">curRowSpacing</a>;
<a name="l00250"></a>00250   <span class="keywordflow">if</span>(c==(<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>-2)){
<a name="l00251"></a>00251     <span class="comment">//quadW = rgPoints0X[idx+1] - rgPoints0X[idx];</span>
<a name="l00252"></a>00252     <span class="comment">//if(quadW&gt;=1.)</span>
<a name="l00253"></a>00253     <span class="comment">//  s = (x - rgPoints0X[idx]) / quadW;</span>
<a name="l00254"></a>00254     quadW = (<a class="code" href="classDMorphInk.html#a9d10a90d3b5a684823850fe7186cf1fc">w0</a>-1)-(c*<a class="code" href="classDMorphInk.html#a1c93aa4e31c88760d35621e48b4b621a">curColSpacing</a>);
<a name="l00255"></a>00255     <span class="keywordflow">if</span>(quadW&gt;0.)
<a name="l00256"></a>00256       s = (x - c*<a class="code" href="classDMorphInk.html#a1c93aa4e31c88760d35621e48b4b621a">curColSpacing</a>) / quadW;
<a name="l00257"></a>00257     <span class="keywordflow">else</span>
<a name="l00258"></a>00258       s = 0.;
<a name="l00259"></a>00259   }
<a name="l00260"></a>00260   <span class="keywordflow">if</span>(r==(<a class="code" href="classDMorphInk.html#a1460be45e5c34f65bfa5e955a49de2cc">numPointRows</a>-2)){
<a name="l00261"></a>00261     <span class="comment">// quadH = rgPoints0Y[idx+numPointCols] - rgPoints0Y[idx];</span>
<a name="l00262"></a>00262     <span class="comment">// if(quadH&gt;=1.)</span>
<a name="l00263"></a>00263     <span class="comment">//   t = (y - rgPoints0Y[idx]) / quadH;</span>
<a name="l00264"></a>00264     <span class="comment">// else</span>
<a name="l00265"></a>00265     <span class="comment">//   t = 0.;</span>
<a name="l00266"></a>00266     quadH = (<a class="code" href="classDMorphInk.html#ab34c8fc99bea6c6c7b2f66077a375ae7">h0</a>-1) - (r*<a class="code" href="classDMorphInk.html#a5a0fe7a38c9ec383a171e325d172bf3d">curRowSpacing</a>);
<a name="l00267"></a>00267     <span class="keywordflow">if</span>(quadH&gt;0.)
<a name="l00268"></a>00268       t = (y - r*<a class="code" href="classDMorphInk.html#a5a0fe7a38c9ec383a171e325d172bf3d">curRowSpacing</a>) / quadH;
<a name="l00269"></a>00269     <span class="keywordflow">else</span>
<a name="l00270"></a>00270       t = 0.;
<a name="l00271"></a>00271   }
<a name="l00272"></a>00272   <span class="keywordflow">if</span>((s &gt; 1.)||(t&gt;1.)){
<a name="l00273"></a>00273     fprintf(stderr,<span class="stringliteral">&quot;WPAT: bad s or t!   x,y=%lf,%lf  r=%d c=%d  idx=%d numPointsCols=%d  s=%lf t=%lf  quadW=%lf quadH=%lf\n&quot;</span>,x,y,r,c,idx,<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>,s,t,quadW,quadH);
<a name="l00274"></a>00274     fprintf(stderr,<span class="stringliteral">&quot;      vertices0: %lf,%lf  %lf,%lf  %lf,%lf  %lf,%lf\n&quot;</span>,
<a name="l00275"></a>00275       <a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>[idx],<a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>[idx],
<a name="l00276"></a>00276       <a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>[idx+1],<a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>[idx+1],
<a name="l00277"></a>00277       <a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1],<a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1],
<a name="l00278"></a>00278       <a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>],<a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>]);
<a name="l00279"></a>00279     fprintf(stderr,<span class="stringliteral">&quot;      vertices1: %lf,%lf  %lf,%lf  %lf,%lf  %lf,%lf\n&quot;</span>,
<a name="l00280"></a>00280       <a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx],<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx],
<a name="l00281"></a>00281       <a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx+1],<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx+1],
<a name="l00282"></a>00282       <a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1],<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1],
<a name="l00283"></a>00283       <a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>],<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>]);
<a name="l00284"></a>00284     fprintf(stderr,<span class="stringliteral">&quot;      CLAMPING VALUE to range 0. to 1.\n&quot;</span>);
<a name="l00285"></a>00285   }
<a name="l00286"></a>00286   <span class="keywordflow">if</span>(s&lt;0.)
<a name="l00287"></a>00287     s=0.;
<a name="l00288"></a>00288   <span class="keywordflow">if</span>(t&lt;0.)
<a name="l00289"></a>00289     t=0.;
<a name="l00290"></a>00290   <span class="keywordflow">if</span>(s&gt;1.)
<a name="l00291"></a>00291     s=1.;
<a name="l00292"></a>00292   <span class="keywordflow">if</span>(t&gt;1.)
<a name="l00293"></a>00293     t=1.;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   <span class="comment">//vertices are in clockwise order (upper-left, up-rt, lower-rt, lower-left)</span>
<a name="l00296"></a>00296   <span class="comment">//calculate the quad vertices at time=dblTime:</span>
<a name="l00297"></a>00297   Ax = (1.0-dblTime)*<a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>[idx]+dblTime*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx];
<a name="l00298"></a>00298   Ay = (1.0-dblTime)*<a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>[idx]+dblTime*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx];
<a name="l00299"></a>00299   Bx = (1.0-dblTime)*<a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>[idx+1]+dblTime*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx+1];
<a name="l00300"></a>00300   By = (1.0-dblTime)*<a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>[idx+1]+dblTime*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx+1];
<a name="l00301"></a>00301   Cx = (1.0-dblTime)*<a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1]+
<a name="l00302"></a>00302     dblTime*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1];
<a name="l00303"></a>00303   Cy = (1.0-dblTime)*<a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1]+
<a name="l00304"></a>00304     dblTime*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1];
<a name="l00305"></a>00305   Dx = (1.0-dblTime)*<a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>]+
<a name="l00306"></a>00306     dblTime*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>];
<a name="l00307"></a>00307   Dy = (1.0-dblTime)*<a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>]+
<a name="l00308"></a>00308     dblTime*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>];
<a name="l00309"></a>00309   <span class="comment">//bilinearly interpolate the point x,y to get it&#39;s warped coordinates xp,yp:</span>
<a name="l00310"></a>00310   Xtop = (1.-s)*Ax + s*Bx;
<a name="l00311"></a>00311   Ytop = (1.-s)*Ay + s*By;
<a name="l00312"></a>00312   Xbot = (1.-s)*Dx + s*Cx;
<a name="l00313"></a>00313   Ybot = (1.-s)*Dy + s*Cy;
<a name="l00314"></a>00314   (*xp) = (1.-t)*Xtop + t*Xbot;
<a name="l00315"></a>00315   (*yp) = (1.-t)*Ytop + t*Ybot;
<a name="l00316"></a>00316   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 
<a name="l00320"></a><a class="code" href="classDMorphInk.html#ae1ffaf3113f7760ed8ccee097d842404">00320</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classDMorphInk.html#ae1ffaf3113f7760ed8ccee097d842404">DMorphInk::warpPoint</a>(<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y, <span class="keywordtype">double</span> *xp, <span class="keywordtype">double</span> *yp,<span class="keywordtype">bool</span> fDebugPrint){
<a name="l00321"></a>00321   <span class="keywordtype">int</span> r, c, idx;
<a name="l00322"></a>00322   <span class="keywordtype">double</span> s,t;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="preprocessor">#if DEBUG_WARP_POINT</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(fDebugPrint){
<a name="l00326"></a>00326     printf(<span class="stringliteral">&quot;warpPoint() inputs: x=%lf y=%lf\n&quot;</span>,x,y);
<a name="l00327"></a>00327   }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329   <span class="keywordflow">if</span>((x&lt;0)||(y&lt;0)||(x&gt;(<a class="code" href="classDMorphInk.html#a9d10a90d3b5a684823850fe7186cf1fc">w0</a>-1))||(y&gt;(<a class="code" href="classDMorphInk.html#ab34c8fc99bea6c6c7b2f66077a375ae7">h0</a>-1))){
<a name="l00330"></a>00330     (*xp)=x;
<a name="l00331"></a>00331     (*yp)=y;
<a name="l00332"></a>00332     fprintf(stderr,
<a name="l00333"></a>00333       <span class="stringliteral">&quot;warpPoint(x,y) out of image0. x=%lf,y=%lf w0=%d,h0=%d\n&quot;</span>,
<a name="l00334"></a>00334       x,y,<a class="code" href="classDMorphInk.html#a9d10a90d3b5a684823850fe7186cf1fc">w0</a>,<a class="code" href="classDMorphInk.html#ab34c8fc99bea6c6c7b2f66077a375ae7">h0</a>);
<a name="l00335"></a>00335     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00336"></a>00336   }
<a name="l00337"></a>00337 <span class="preprocessor">#endif</span>
<a name="l00338"></a>00338 <span class="preprocessor"></span>
<a name="l00339"></a>00339   <span class="comment">//r,c are easy to find because mesh0 is evenly spaced</span>
<a name="l00340"></a>00340   s = x / <a class="code" href="classDMorphInk.html#a1c93aa4e31c88760d35621e48b4b621a">curColSpacing</a>;
<a name="l00341"></a>00341   t = y / <a class="code" href="classDMorphInk.html#a5a0fe7a38c9ec383a171e325d172bf3d">curRowSpacing</a>;
<a name="l00342"></a>00342   <span class="comment">// c = (int)s;</span>
<a name="l00343"></a>00343   <span class="comment">// r = (int)t;</span>
<a name="l00344"></a>00344   c = (int)s;
<a name="l00345"></a>00345   <span class="keywordflow">if</span>(c == (<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>-1))<span class="comment">//if last pixel, make it s=1.0 for c=numPointsCols-2</span>
<a name="l00346"></a>00346     --c;
<a name="l00347"></a>00347   r = (int)t;
<a name="l00348"></a>00348   <span class="keywordflow">if</span>(r == (<a class="code" href="classDMorphInk.html#a1460be45e5c34f65bfa5e955a49de2cc">numPointRows</a>-1))<span class="comment">//if last pixel, make it t=1.0 for r=numPointsRows-2</span>
<a name="l00349"></a>00349     --r;
<a name="l00350"></a>00350   idx = r*<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+c;
<a name="l00351"></a>00351   s -= c;
<a name="l00352"></a>00352   t -= r;
<a name="l00353"></a>00353 <span class="preprocessor">#if DEBUG_WARP_POINT</span>
<a name="l00354"></a>00354 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(fDebugPrint){
<a name="l00355"></a>00355     printf(<span class="stringliteral">&quot;  s=%lf t=%lf  c=%d r=%d\n&quot;</span>,s,t, c, r);
<a name="l00356"></a>00356   }
<a name="l00357"></a>00357 <span class="preprocessor">#endif</span>
<a name="l00358"></a>00358 <span class="preprocessor"></span>
<a name="l00359"></a>00359   <span class="keywordtype">double</span> quadW;
<a name="l00360"></a>00360   <span class="keywordtype">double</span> quadH;
<a name="l00361"></a>00361   quadW = <a class="code" href="classDMorphInk.html#a1c93aa4e31c88760d35621e48b4b621a">curColSpacing</a>;
<a name="l00362"></a>00362   quadH = <a class="code" href="classDMorphInk.html#a5a0fe7a38c9ec383a171e325d172bf3d">curRowSpacing</a>;
<a name="l00363"></a>00363   <span class="keywordflow">if</span>(c==(<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>-2)){
<a name="l00364"></a>00364     quadW = <a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>[idx+1] - <a class="code" href="classDMorphInk.html#a3c2f68e334ce653db1f8a7b2eab431d6">rgPoints0X</a>[idx];
<a name="l00365"></a>00365     <span class="keywordflow">if</span>(quadW&gt;0.)<span class="comment">//changed from &gt;=1. to &gt; 0.(changed after dissertation)</span>
<a name="l00366"></a>00366       s = (x - rgPoints0X[idx]) / quadW;
<a name="l00367"></a>00367     <span class="keywordflow">else</span>
<a name="l00368"></a>00368       s = 0.;
<a name="l00369"></a>00369 <span class="comment">// #if CHECK_OLD_WARP</span>
<a name="l00370"></a>00370 <span class="comment">//     {</span>
<a name="l00371"></a>00371 <span class="comment">//       double otherQuadW;</span>
<a name="l00372"></a>00372 <span class="comment">//       double otherS;</span>
<a name="l00373"></a>00373 <span class="comment">//       otherQuadW = (w0-1)-(c*curColSpacing);</span>
<a name="l00374"></a>00374 <span class="comment">//       if(abs(otherQuadW-quadW) &gt; 0.0001){</span>
<a name="l00375"></a>00375 <span class="comment">//  fprintf(stderr,&quot;CHECK_OLD_WARP found discrepancy: quadW=%lf otherQuadW=%lf\n&quot;,quadW,otherQuadW);</span>
<a name="l00376"></a>00376 <span class="comment">//       }</span>
<a name="l00377"></a>00377 <span class="comment">//       if(quadW&gt;0.)</span>
<a name="l00378"></a>00378 <span class="comment">//  otherS = (x - c*curColSpacing) / quadW;</span>
<a name="l00379"></a>00379 <span class="comment">//       else</span>
<a name="l00380"></a>00380 <span class="comment">//  otherS = 0.;</span>
<a name="l00381"></a>00381 <span class="comment">//       if(abs(otherS-s) &gt; 0.0001){</span>
<a name="l00382"></a>00382 <span class="comment">//  fprintf(stderr,&quot;CHECK_OLD_WARP found discrepancy: s=%lf otherS=%lf\n&quot;,s,</span>
<a name="l00383"></a>00383 <span class="comment">//    otherS);</span>
<a name="l00384"></a>00384 <span class="comment">//       }</span>
<a name="l00385"></a>00385 <span class="comment">//     }</span>
<a name="l00386"></a>00386 <span class="comment">// #endif</span>
<a name="l00387"></a>00387   }
<a name="l00388"></a>00388   <span class="keywordflow">if</span>(r==(<a class="code" href="classDMorphInk.html#a1460be45e5c34f65bfa5e955a49de2cc">numPointRows</a>-2)){
<a name="l00389"></a>00389     quadH = <a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>] - <a class="code" href="classDMorphInk.html#a7aa52649c865065d1d2c1fd15ed8a8ed">rgPoints0Y</a>[idx];
<a name="l00390"></a>00390     <span class="keywordflow">if</span>(quadH&gt;0.)<span class="comment">//changed from &gt;=1. to &gt;0. (after dissertation)</span>
<a name="l00391"></a>00391       t = (y - rgPoints0Y[idx]) / quadH;
<a name="l00392"></a>00392     <span class="keywordflow">else</span>
<a name="l00393"></a>00393       t = 0.;
<a name="l00394"></a>00394   }
<a name="l00395"></a>00395 <span class="preprocessor">#if DEBUG_WARP_POINT</span>
<a name="l00396"></a>00396 <span class="preprocessor"></span>  <span class="keywordflow">if</span>((s &gt; 1.)||(t&gt;1.)){
<a name="l00397"></a>00397     fprintf(stderr,<span class="stringliteral">&quot;warpPoint(): bad s or t!!!   x,y=%lf,%lf  r=%d c=%d  idx=%d numPointsCols=%d  s=%lf t=%lf  quadW=%lf quadH=%lf (CLAMPING)\n&quot;</span>,
<a name="l00398"></a>00398      x,y,r,c,idx,<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>,s,t,quadW,quadH);
<a name="l00399"></a>00399   }
<a name="l00400"></a>00400 <span class="preprocessor">#endif</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(s&lt;0.)
<a name="l00402"></a>00402     s=0.;
<a name="l00403"></a>00403   <span class="keywordflow">if</span>(t&lt;0.)
<a name="l00404"></a>00404     t=0.;
<a name="l00405"></a>00405   <span class="keywordflow">if</span>(s&gt;1.)
<a name="l00406"></a>00406     s=1.;
<a name="l00407"></a>00407   <span class="keywordflow">if</span>(t&gt;1.)
<a name="l00408"></a>00408     t=1.;
<a name="l00409"></a>00409      
<a name="l00410"></a>00410 <span class="preprocessor">#if DEBUG_WARP_POINT</span>
<a name="l00411"></a>00411 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(fDebugPrint){
<a name="l00412"></a>00412     printf(<span class="stringliteral">&quot;  quadW=%lf quadH=%lf\n&quot;</span>,quadW, quadH);
<a name="l00413"></a>00413     printf(<span class="stringliteral">&quot;  corrected s=%lf t=%lf\n&quot;</span>,s,t);
<a name="l00414"></a>00414   }
<a name="l00415"></a>00415 <span class="preprocessor">#endif</span>
<a name="l00416"></a>00416 <span class="preprocessor"></span>
<a name="l00417"></a>00417   <span class="comment">//bilinearly interpolate the point x,y to get its warped coordinates xp,yp:</span>
<a name="l00418"></a>00418   <span class="keywordtype">double</span> Xtop, Ytop, Xbot, Ybot;
<a name="l00419"></a>00419   Xtop = (1.-s)*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx] + s*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx+1];
<a name="l00420"></a>00420   Ytop = (1.-s)*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx] + s*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx+1];
<a name="l00421"></a>00421   Xbot = (1.-s)*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>] + s*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1];
<a name="l00422"></a>00422   Ybot = (1.-s)*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>] + s*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1];
<a name="l00423"></a>00423   (*xp) = (1.-t)*Xtop + t*Xbot;
<a name="l00424"></a>00424   (*yp) = (1.-t)*Ytop + t*Ybot;
<a name="l00425"></a>00425 <span class="preprocessor">#if DEBUG_WARP_POINT</span>
<a name="l00426"></a>00426 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(fDebugPrint){
<a name="l00427"></a>00427     printf(<span class="stringliteral">&quot;  Xtop=%lf Ytop=%lf  Xbot=%lf Ybot=%lf  xp=%lf yp=%lf\n&quot;</span>,
<a name="l00428"></a>00428      Xtop, Ytop, Xbot, Ybot, *xp, *yp);
<a name="l00429"></a>00429   }
<a name="l00430"></a>00430 <span class="preprocessor">#endif</span>
<a name="l00431"></a>00431 <span class="preprocessor"></span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00432"></a>00432 }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 
<a name="l00435"></a>00435 <span class="comment">//cost of a vertex position (using distance map of warped ink pixels in 4 quads)</span>
<a name="l00436"></a>00436 <span class="comment">//inlining this function sped us up about 10%</span>
<a name="l00437"></a><a class="code" href="classDMorphInk.html#a72b281fcba3e7d904c723185a93e3862">00437</a> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#a72b281fcba3e7d904c723185a93e3862">DMorphInk::getVertexPositionCost</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c,
<a name="l00438"></a>00438                  <span class="keywordtype">double</span> x1, <span class="keywordtype">double</span> y1){
<a name="l00439"></a>00439   <span class="keywordtype">double</span> sumCost = 0.;
<a name="l00440"></a>00440   <span class="keywordtype">int</span> inkPxls = 0;<span class="comment">//count of ink pixels in quads</span>
<a name="l00441"></a>00441   <span class="keywordtype">signed</span> <span class="keywordtype">int</span> *psDist;
<a name="l00442"></a>00442   <span class="keywordtype">int</span> idxVertex;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444   idxVertex = r*<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+c;<span class="comment">//index in control point arrays of this vertex</span>
<a name="l00445"></a>00445   psDist = (<span class="keywordtype">signed</span> <span class="keywordtype">int</span>*)<a class="code" href="classDMorphInk.html#abe11be729724802b7e22392b5ab9608f">imgDist1</a>.<a class="code" href="classDImage.html#ac0250d1bb6ac76b273be367c9ed02dc8">dataPointer_u32</a>();
<a name="l00446"></a>00446 
<a name="l00447"></a>00447   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="classDMorphInk.html#afc821bd03aebde29d85de74f6910d3bc">tempMA0len</a>; ++i){
<a name="l00448"></a>00448     <span class="keywordtype">double</span> xp, yp;
<a name="l00449"></a>00449     <span class="keywordtype">int</span> ixp, iyp;
<a name="l00450"></a>00450     <span class="keywordtype">double</span> vxTmp, vyTmp; <span class="comment">// store the vertex before changing it to set back</span>
<a name="l00451"></a>00451     
<a name="l00452"></a>00452     vxTmp = <a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idxVertex];
<a name="l00453"></a>00453     vyTmp = <a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idxVertex];
<a name="l00454"></a>00454     <a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idxVertex] = x1;
<a name="l00455"></a>00455     <a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idxVertex] = y1;
<a name="l00456"></a>00456     <a class="code" href="classDMorphInk.html#ae1ffaf3113f7760ed8ccee097d842404">warpPoint</a>(<a class="code" href="classDMorphInk.html#ad6415cde09c56ec851c9abebf538f507">rgTempMA0X</a>[i], <a class="code" href="classDMorphInk.html#a6224c8be0e9c5da72766e61ddb1e9912">rgTempMA0Y</a>[i], &amp;xp, &amp;yp);
<a name="l00457"></a>00457     <a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idxVertex] = vxTmp;
<a name="l00458"></a>00458     <a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idxVertex] = vyTmp;
<a name="l00459"></a>00459     ixp=(int)xp;
<a name="l00460"></a>00460     iyp=(int)yp;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     <span class="keywordtype">int</span> addDistX, addDistY; <span class="comment">// if the position is off the distmap, compensate</span>
<a name="l00463"></a>00463     addDistX = addDistY = 0;
<a name="l00464"></a>00464 <span class="preprocessor">#if 1 </span><span class="comment">/*COMPENSATE_FOR_OOB_DISTMAP*/</span>
<a name="l00465"></a>00465     <span class="keywordflow">if</span>(ixp &lt; 0){
<a name="l00466"></a>00466       addDistX = 0-ixp;
<a name="l00467"></a>00467       ixp = 0;
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ixp &gt;  (<a class="code" href="classDMorphInk.html#ab66030e7c8782eb1174513f4b9e31b84">w1</a>-1)){
<a name="l00470"></a>00470       addDistX = ixp-<a class="code" href="classDMorphInk.html#ab66030e7c8782eb1174513f4b9e31b84">w1</a>+1;
<a name="l00471"></a>00471       ixp = w1-1;
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473     <span class="keywordflow">if</span>(iyp &lt; 0){
<a name="l00474"></a>00474       addDistY = 0-iyp;
<a name="l00475"></a>00475       iyp = 0;
<a name="l00476"></a>00476     }
<a name="l00477"></a>00477     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iyp &gt; (<a class="code" href="classDMorphInk.html#ae34737032c7664485685e84712d56217">h1</a>-1)){
<a name="l00478"></a>00478       addDistY = iyp-<a class="code" href="classDMorphInk.html#ae34737032c7664485685e84712d56217">h1</a>+1;
<a name="l00479"></a>00479       iyp = h1-1;
<a name="l00480"></a>00480     }
<a name="l00481"></a>00481 <span class="preprocessor">#endif </span><span class="comment">/*COMPENSATE_FOR_OOB_DISTMAP*/</span>
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     sumCost += psDist[<a class="code" href="classDMorphInk.html#ab66030e7c8782eb1174513f4b9e31b84">w1</a>*iyp+ixp] + addDistX + addDistY;
<a name="l00484"></a>00484     ++inkPxls;
<a name="l00485"></a>00485     
<a name="l00486"></a>00486   }
<a name="l00487"></a>00487   <span class="keywordflow">if</span>(sumCost &gt; 0)
<a name="l00488"></a>00488     sumCost = sumCost/(inkPxls);
<a name="l00489"></a>00489   <span class="comment">//sumCost = sumCost/(1+inkPxls);</span>
<a name="l00490"></a>00490 
<a name="l00491"></a>00491   <span class="keywordflow">return</span> sumCost;
<a name="l00492"></a>00492 }
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 
<a name="l00500"></a>00500 <span class="preprocessor">#if NEW_WARP</span>
<a name="l00501"></a>00501 <span class="preprocessor"></span>
<a name="l00502"></a>00502 <span class="preprocessor">#include &lt;execinfo.h&gt;</span>
<a name="l00503"></a><a class="code" href="dmorphink_8h.html#a4bb1325b53dcb653e95a7935165c3b0e">00503</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="dmorphink_8h.html#a4bb1325b53dcb653e95a7935165c3b0e">print_stack</a>(){
<a name="l00504"></a>00504   <span class="keywordtype">void</span> **rgStackFrames;
<a name="l00505"></a>00505   <span class="keywordtype">int</span> numFrames;
<a name="l00506"></a>00506 
<a name="l00507"></a>00507   rgStackFrames= <span class="keyword">new</span> <span class="keywordtype">void</span>*[100];
<a name="l00508"></a>00508   numFrames = backtrace(rgStackFrames, 100);
<a name="l00509"></a>00509   <span class="keywordtype">char</span> **rgStackFrameSymbols;
<a name="l00510"></a>00510   
<a name="l00511"></a>00511   rgStackFrameSymbols = backtrace_symbols(rgStackFrames, numFrames);
<a name="l00512"></a>00512   fprintf(stderr,<span class="stringliteral">&quot;stack trace:\n&quot;</span>);
<a name="l00513"></a>00513   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i &lt; numFrames; ++i){
<a name="l00514"></a>00514     fprintf(stderr,<span class="stringliteral">&quot;  %s\n&quot;</span>,rgStackFrameSymbols[i]);
<a name="l00515"></a>00515   }
<a name="l00516"></a>00516   free(rgStackFrameSymbols);
<a name="l00517"></a>00517   <span class="keyword">delete</span> [] rgStackFrames;
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 
<a name="l00522"></a>00522 <span class="comment">//instead of x,y use s,t, and idx</span>
<a name="l00523"></a>00523 <span class="comment">//this new version speeds us up by 33% from where we were when using the old warpPoint function</span>
<a name="l00524"></a><a class="code" href="classDMorphInk.html#ac12c0b70e56ec25a1d70faf24848441d">00524</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classDMorphInk.html#ac12c0b70e56ec25a1d70faf24848441d">DMorphInk::warpPointNew</a>(<span class="keywordtype">double</span> s, <span class="keywordtype">double</span> t, <span class="keywordtype">int</span> meshPointIdx,
<a name="l00525"></a>00525             <span class="keywordtype">double</span> *xp, <span class="keywordtype">double</span> *yp<span class="comment">//,</span>
<a name="l00526"></a>00526             <span class="comment">/*debug:double x,double y,</span>
<a name="l00527"></a>00527 <span class="comment">            int ii,int l,int rgTempMA0idx_i,</span>
<a name="l00528"></a>00528 <span class="comment">            int r, int c*/</span>){
<a name="l00529"></a>00529   <span class="comment">//FYI: meshPointIdx = r*numPointCols+c;</span>
<a name="l00530"></a>00530 
<a name="l00531"></a>00531   <span class="comment">//bilinearly interpolate the point x,y to get its warped coordinates xp,yp:</span>
<a name="l00532"></a>00532   <span class="keywordtype">double</span> Xtop, Ytop, Xbot, Ybot;
<a name="l00533"></a>00533   <span class="keywordtype">double</span> oneMs, oneMt;<span class="comment">//1-s and 1-t</span>
<a name="l00534"></a>00534   oneMs = 1.-s;
<a name="l00535"></a>00535   oneMt = 1.-t;
<a name="l00536"></a>00536   Xtop = (oneMs)*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[meshPointIdx] + s*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[meshPointIdx+1];
<a name="l00537"></a>00537   Ytop = (oneMs)*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[meshPointIdx] + s*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[meshPointIdx+1];
<a name="l00538"></a>00538   Xbot = (oneMs)*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[meshPointIdx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>] +
<a name="l00539"></a>00539     s*<a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[meshPointIdx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1];
<a name="l00540"></a>00540   Ybot = (oneMs)*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[meshPointIdx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>] +
<a name="l00541"></a>00541     s*<a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[meshPointIdx+<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+1];
<a name="l00542"></a>00542   (*xp) = (oneMt)*Xtop + t*Xbot;
<a name="l00543"></a>00543   (*yp) = (oneMt)*Ytop + t*Ybot;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 <span class="preprocessor">#if 0</span>
<a name="l00546"></a>00546 <span class="preprocessor"></span>  {<span class="comment">//debug</span>
<a name="l00547"></a>00547     <span class="keywordtype">double</span> xp2, yp2;
<a name="l00548"></a>00548     <span class="keywordflow">if</span>(!<a class="code" href="classDMorphInk.html#ae1ffaf3113f7760ed8ccee097d842404">warpPoint</a>(x,y,&amp;xp2,&amp;yp2)){
<a name="l00549"></a>00549       fprintf(stderr,<span class="stringliteral">&quot;warpPointNew() debug check with warpPoint: warpPoint returned false! xp=%lf,yp=%lf  xp2=%lf,yp2=%lf\n&quot;</span>,*xp,*yp,xp2,yp2);
<a name="l00550"></a>00550       <a class="code" href="dmorphink_8h.html#a4bb1325b53dcb653e95a7935165c3b0e">print_stack</a>();
<a name="l00551"></a>00551       exit(1);
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553     <span class="keywordflow">if</span>((xp2!=(*xp))||(yp2!=(*yp))){
<a name="l00554"></a>00554       fprintf(stderr,<span class="stringliteral">&quot;warpPointNew() debug check with warpPoint: xp=%lf,yp=%lf  xp2=%lf,yp2=%lf  s=%lf,t=%lf x=%lf,y=%lf ii=%d l=%d rgTempMA0idx_i=%d r=%d c=%d\n&quot;</span>,
<a name="l00555"></a>00555         *xp,*yp,xp2,yp2,s,t,x,y,ii,l,rgTempMA0idx_i,r,c);
<a name="l00556"></a>00556       fprintf(stderr,<span class="stringliteral">&quot;numPointRows=%d numPointCols=%d\n&quot;</span>,<a class="code" href="classDMorphInk.html#a1460be45e5c34f65bfa5e955a49de2cc">numPointRows</a>,
<a name="l00557"></a>00557         <a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>);
<a name="l00558"></a>00558       <a class="code" href="dmorphink_8h.html#a4bb1325b53dcb653e95a7935165c3b0e">print_stack</a>();
<a name="l00559"></a>00559       exit(1);
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561   }
<a name="l00562"></a>00562 <span class="preprocessor">#endif</span>
<a name="l00563"></a>00563 <span class="preprocessor"></span>
<a name="l00564"></a>00564   <span class="comment">//  return true;</span>
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 
<a name="l00569"></a>00569 <span class="comment">//cost of a vertex position (using distance map of warped ink pixels in 4 quads)</span>
<a name="l00570"></a>00570 <span class="comment">//inlining this function speeds us up about 10%</span>
<a name="l00571"></a><a class="code" href="classDMorphInk.html#ab8fda39ed4fcca5acfc5d2cddf06fbf6">00571</a> <span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="classDMorphInk.html#ab8fda39ed4fcca5acfc5d2cddf06fbf6">DMorphInk::getVertexPositionCostNew</a>(<span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c,
<a name="l00572"></a>00572               <span class="keywordtype">double</span> x1, <span class="keywordtype">double</span> y1){
<a name="l00573"></a>00573   <span class="keywordtype">double</span> sumCost = 0.;
<a name="l00574"></a>00574   <span class="keywordtype">int</span> inkPxls = 0;<span class="comment">//count of ink pixels in quads</span>
<a name="l00575"></a>00575   <span class="keywordtype">signed</span> <span class="keywordtype">int</span> *psDist;
<a name="l00576"></a>00576   <span class="keywordtype">int</span> idxVertex;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578   idxVertex = r*<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+c;<span class="comment">//index in control point arrays of this vertex</span>
<a name="l00579"></a>00579   psDist = (<span class="keywordtype">signed</span> <span class="keywordtype">int</span>*)<a class="code" href="classDMorphInk.html#abe11be729724802b7e22392b5ab9608f">imgDist1</a>.<a class="code" href="classDImage.html#ac0250d1bb6ac76b273be367c9ed02dc8">dataPointer_u32</a>();
<a name="l00580"></a>00580 
<a name="l00581"></a>00581   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="classDMorphInk.html#afc821bd03aebde29d85de74f6910d3bc">tempMA0len</a>; ++i){
<a name="l00582"></a>00582     <span class="keywordtype">double</span> xp, yp;
<a name="l00583"></a>00583     <span class="keywordtype">int</span> ixp, iyp;
<a name="l00584"></a>00584     <span class="keywordtype">double</span> vxTmp, vyTmp; <span class="comment">// store the vertex before changing it to set back</span>
<a name="l00585"></a>00585     
<a name="l00586"></a>00586     vxTmp = <a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idxVertex];
<a name="l00587"></a>00587     vyTmp = <a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idxVertex];
<a name="l00588"></a>00588     <a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idxVertex] = x1;
<a name="l00589"></a>00589     <a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idxVertex] = y1;
<a name="l00590"></a>00590     <span class="comment">// warpPoint(rgTempMA0X[i], rgTempMA0Y[i], &amp;xp, &amp;yp);</span>
<a name="l00591"></a>00591     <a class="code" href="classDMorphInk.html#ac12c0b70e56ec25a1d70faf24848441d">warpPointNew</a>(<a class="code" href="classDMorphInk.html#a46ca12996c149156a9a3f2d8578a06cf">rgMA0s</a>[<a class="code" href="classDMorphInk.html#ad9a46e1b8f0d6e02ee16689d884abb15">rgTempMA0idx</a>[i]], <a class="code" href="classDMorphInk.html#a981f15cf32ed62c4531c24c664b8408e">rgMA0t</a>[<a class="code" href="classDMorphInk.html#ad9a46e1b8f0d6e02ee16689d884abb15">rgTempMA0idx</a>[i]],
<a name="l00592"></a>00592      <a class="code" href="classDMorphInk.html#a552ebccb2864be1b79e852ff62f97cca">rgMA0r</a>[<a class="code" href="classDMorphInk.html#ad9a46e1b8f0d6e02ee16689d884abb15">rgTempMA0idx</a>[i]]*<a class="code" href="classDMorphInk.html#ae652e47c4b939e47ed2d6e0ba6b3924e">numPointCols</a>+<a class="code" href="classDMorphInk.html#aeeb1d6ed29d5744836b82def50ba0bf2">rgMA0c</a>[<a class="code" href="classDMorphInk.html#ad9a46e1b8f0d6e02ee16689d884abb15">rgTempMA0idx</a>[i]],
<a name="l00593"></a>00593      &amp;xp, &amp;yp<span class="comment">/*debug: ,rgTempMA0X[i], rgTempMA0Y[i],i,lenMA0,</span>
<a name="l00594"></a>00594 <span class="comment">         rgTempMA0idx[i],r,c*/</span>);
<a name="l00595"></a>00595     <a class="code" href="classDMorphInk.html#ab41924b59004b8f5c939bb9adf26b238">rgPoints1X</a>[idxVertex] = vxTmp;
<a name="l00596"></a>00596     <a class="code" href="classDMorphInk.html#a15ad4efeba305f00917cfd3bb9f4b834">rgPoints1Y</a>[idxVertex] = vyTmp;
<a name="l00597"></a>00597     ixp=(int)xp;
<a name="l00598"></a>00598     iyp=(int)yp;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600     <span class="keywordtype">int</span> addDistX, addDistY; <span class="comment">// if the position is off the distmap, compensate</span>
<a name="l00601"></a>00601     addDistX = addDistY = 0;
<a name="l00602"></a>00602 <span class="preprocessor">#if 1 </span><span class="comment">/*COMPENSATE_FOR_OOB_DISTMAP*/</span>
<a name="l00603"></a>00603     <span class="keywordflow">if</span>(ixp &lt; 0){
<a name="l00604"></a>00604       addDistX = 0-ixp;
<a name="l00605"></a>00605       ixp = 0;
<a name="l00606"></a>00606     }
<a name="l00607"></a>00607     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ixp &gt;  (<a class="code" href="classDMorphInk.html#ab66030e7c8782eb1174513f4b9e31b84">w1</a>-1)){
<a name="l00608"></a>00608       addDistX = ixp-<a class="code" href="classDMorphInk.html#ab66030e7c8782eb1174513f4b9e31b84">w1</a>+1;
<a name="l00609"></a>00609       ixp = w1-1;
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611     <span class="keywordflow">if</span>(iyp &lt; 0){
<a name="l00612"></a>00612       addDistY = 0-iyp;
<a name="l00613"></a>00613       iyp = 0;
<a name="l00614"></a>00614     }
<a name="l00615"></a>00615     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iyp &gt; (<a class="code" href="classDMorphInk.html#ae34737032c7664485685e84712d56217">h1</a>-1)){
<a name="l00616"></a>00616       addDistY = iyp-<a class="code" href="classDMorphInk.html#ae34737032c7664485685e84712d56217">h1</a>+1;
<a name="l00617"></a>00617       iyp = h1-1;
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619 <span class="preprocessor">#endif </span><span class="comment">/*COMPENSATE_FOR_OOB_DISTMAP*/</span>
<a name="l00620"></a>00620 
<a name="l00621"></a>00621     sumCost += psDist[<a class="code" href="classDMorphInk.html#ab66030e7c8782eb1174513f4b9e31b84">w1</a>*iyp+ixp] + addDistX + addDistY;
<a name="l00622"></a>00622     ++inkPxls;
<a name="l00623"></a>00623     
<a name="l00624"></a>00624   }
<a name="l00625"></a>00625   <span class="keywordflow">if</span>(sumCost &gt; 0)<span class="comment">//sumCost==0 if inkPxls is zero, and some other times too</span>
<a name="l00626"></a>00626     sumCost = sumCost/(inkPxls);
<a name="l00627"></a>00627   <span class="comment">//sumCost = sumCost/(1+inkPxls);</span>
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 <span class="preprocessor">#if 0</span>
<a name="l00630"></a>00630 <span class="preprocessor"></span>  {<span class="comment">//debug</span>
<a name="l00631"></a>00631     <span class="keywordflow">if</span>(sumCost != <a class="code" href="classDMorphInk.html#a72b281fcba3e7d904c723185a93e3862">getVertexPositionCost</a>(r,c,x1,y1)){
<a name="l00632"></a>00632       fprintf(stderr,<span class="stringliteral">&quot;getVertexPositionCostNew() returns different value than &quot;</span>
<a name="l00633"></a>00633         <span class="stringliteral">&quot;getVertexPositionCost()\n&quot;</span>);
<a name="l00634"></a>00634       exit(1);
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636   }
<a name="l00637"></a>00637 <span class="preprocessor">#endif</span>
<a name="l00638"></a>00638 <span class="preprocessor"></span>
<a name="l00639"></a>00639   <span class="keywordflow">return</span> sumCost;
<a name="l00640"></a>00640 }
<a name="l00641"></a>00641 <span class="preprocessor">#endif //NEW_WARP</span>
<a name="l00642"></a>00642 <span class="preprocessor"></span>
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 
<a name="l00645"></a>00645 <span class="preprocessor">#endif</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Aug 30 2013 20:45:42 by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
